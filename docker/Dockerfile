FROM alpine:latest

ARG KEY="-----BEGIN OPENSSH PRIVATE KEY-----\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\t228kT3TIY0tLVDlyJPg/ZAm0=\n-----END OPENSSH PRIVATE KEY-----"


ENV REPO_URL=git@github.com:yueqingshu1/ceshi.git \
    REPO_BRANCH=main

WORKDIR /asm-unicom/

RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apk/repositories
RUN apk add --no-cache tzdata git nodejs moreutils npm curl jq openssh-client
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
RUN mkdir -p /root/.ssh
RUN echo -e $KEY > /root/.ssh/id_rsa
RUN chmod 600 /root/.ssh/id_rsa
RUN ssh-keyscan github.com > /root/.ssh/known_hosts
RUN git clone -b $REPO_BRANCH $REPO_URL /asm-unicom

 # 复制代码
#COPY . /asm-unicom/

RUN npm config set registry https://registry.npm.taobao.org
RUN npm install

RUN rm -rf /usr/local/bin/entrypoint.sh
COPY docker/entrypoint.sh /usr/local/bin
RUN chmod +x /usr/local/bin/entrypoint.sh

ENTRYPOINT ["entrypoint.sh"]
CMD ["crond"]

