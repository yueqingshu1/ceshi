FROM alpine:latest

ARG KEY="-----BEGIN OPENSSH PRIVATE KEY-----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-----END OPENSSH PRIVATE KEY-----"


ENV REPO_URL=git@github.com:yueqingshu1/ceshi.git \
    REPO_BRANCH=main

WORKDIR /asm-unicom/

RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apk/repositories
RUN apk add --no-cache tzdata git nodejs moreutils npm curl jq openssh-client
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
RUN mkdir -p /root/.ssh
RUN echo -e $KEY > /root/.ssh/id_rsa
RUN echo /root/.ssh/id_rsa
RUN chmod 600 /root/.ssh/id_rsa
RUN ssh-keyscan github.com > /root/.ssh/known_hosts
RUN git clone -b $REPO_BRANCH $REPO_URL /asm-unicom

 # 复制代码
#COPY . /asm-unicom/

RUN npm config set registry https://registry.npm.taobao.org
RUN npm install

RUN rm -rf /usr/local/bin/entrypoint.sh
COPY docker/entrypoint.sh /usr/local/bin
RUN chmod +x /usr/local/bin/entrypoint.sh

ENTRYPOINT ["entrypoint.sh"]
CMD ["crond"]

